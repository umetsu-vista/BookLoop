# BookLoop — 画面設計書 v1.0

> **最終更新:** 2026-02-24
> **対象:** MVP（Phase 1）全画面
> **前提ドキュメント:** 要件定義書 v1.0 / MVP ワイヤーフレーム

---

## 1. 画面遷移図

```
                    ┌──────────┐
                    │ S-01     │
                    │ スプラッシュ│
                    └────┬─────┘
                         │
                    ┌────▼─────┐   未認証    ┌──────────┐
                    │ 認証判定  │───────────→│ S-03     │
                    └────┬─────┘            │ ログイン  │
                         │ 認証済           └────┬─────┘
                         │                      │ 認証成功
                    ┌────▼─────┐                │
               ┌───→│ 初回判定  │←───────────────┘
               │    └────┬─────┘
               │         │ 初回          │ 2回目以降
               │    ┌────▼─────┐         │
               │    │ S-02     │         │
               │    │ オンボーディング│     │
               │    └────┬─────┘         │
               │         │ 完了          │
               │    ┌────▼───────────────▼────┐
               │    │                          │
               │    │    メインタブナビゲーション     │
               │    │                          │
               │    │  ┌──────┬──────┬──────┐  │
               │    │  │ S-04 │ S-05 │ S-10 │  │
               │    │  │ホーム │ 本棚 │ 統計 │  │
               │    │  └──┬───┴──┬───┴──────┘  │
               │    │     │      │    S-11 設定 │
               │    └─────┼──────┼─────────────┘
               │          │      │
               │     ┌────▼──┐ ┌─▼──────┐
               │     │ S-08a │ │ S-06   │
               │     │セッション│ │書籍検索│
               │     │ 開始  │ └──┬─────┘
               │     └──┬──┬─┘   │
               │  アプリ内│  │外部   │
               │   ┌────▼┐┌▼────┐ │
               │   │S-08 ││S-08b│ │
               │   │読書  ││外部  │ │
               │   │セッション││読書中│ │
               │   └──┬──┘└──┬──┘ │
               │      └──┬───┘    │
               │    ┌────▼─────┐  │
               │    │ S-09     │  │
               │    │ セッション │  │
               │    │ 完了     │  │
               │    └────┬─────┘  │
               │         │ 保存   │
               └─────────┘        │
                                  │
              ┌──────┐       ┌────▼─────┐
              │S-08c │       │ S-07     │
              │あとから│←──────│ 書籍詳細 │
              │記録   │       └──────────┘
              └──┬───┘
                 │ 保存
                 └──→ S-04 ホーム
```

---

## 2. 共通設計

### 2.1 デザイントークン

| トークン | 値 | 用途 |
|---|---|---|
| **Primary** | `gray-800` (#1F2937) | CTA、アクティブ状態、ストリーク強調 |
| **Background** | `gray-50` (#F9FAFB) | アプリ全体の背景 |
| **Surface** | `white` (#FFFFFF) | カード・入力フィールドの背景 |
| **Text Primary** | `gray-800` (#1F2937) | 見出し・重要テキスト |
| **Text Secondary** | `gray-500` (#6B7280) | 補足テキスト |
| **Text Tertiary** | `gray-400` (#9CA3AF) | ラベル・プレースホルダー |
| **Border** | `gray-300` (#D1D5DB) | カード枠線 |
| **Session Dark BG** | `gray-900` (#111827) | 読書セッション画面背景 |
| **Streak Gradient** | `gray-800` → `gray-600` | ストリークカード |
| **Kindle Accent** | `amber-500` (#F59E0B) | Kindle 関連の識別色 |
| **Kobo Accent** | `blue-500` (#3B82F6) | Kobo 関連の識別色 |
| **Apple Books Accent** | `orange-500` (#F97316) | Apple Books 関連の識別色 |
| **Success** | `green-500` (#22C55E) | 完了・達成 |
| **Danger** | `red-500` (#EF4444) | 削除・エラー |

### 2.2 タイポグラフィ

| スタイル | サイズ | ウェイト | 用途 |
|---|---|---|---|
| **Display** | 48–72px | Black (900) | タイマー表示、ストリーク数 |
| **Heading 1** | 20–24px | Bold (700) | 画面タイトル |
| **Heading 2** | 16px | SemiBold (600) | セクション見出し |
| **Body** | 14px | Regular (400) | 本文テキスト |
| **Caption** | 12px | Medium (500) | ラベル、補足 |
| **Micro** | 10–11px | Medium (500) | タグ、バッジ、ナビ |

**フォント:** System UI（iOS: SF Pro, Android: Roboto, Web: Inter）

### 2.3 共通コンポーネント

#### BottomNavigation

```
┌──────────────────────────────────────┐
│  🏠 ホーム   📚 本棚   📊 統計   👤 設定  │
└──────────────────────────────────────┘
```

- 4 タブ固定。アクティブタブは `gray-800`、非アクティブは `gray-400`
- セッション中（S-08 / S-08b）は非表示

#### BookCard（書籍カード）

```
┌─────────────────────────────┐
│ ┌──────┐ タイトル            │
│ │ 書影  │ 著者名             │
│ │      │ ████████░░ 67%     │
│ └──────┘                    │
└─────────────────────────────┘
```

- 書影: 48×64px（グリッド時は幅100%×アスペクト比 2:3）
- フォールバック: 書名の先頭 4 文字をパステルカラー背景に表示
- 進捗バー: `gray-800`（読書中のみ表示）

#### PrimaryButton / OutlineButton

- **Primary:** `bg-gray-800 text-white rounded-xl py-3` — 全幅
- **Outline:** `border-2 border-gray-800 text-gray-800 rounded-xl py-3` — 全幅
- タップ時: opacity 0.8 + scale 0.98（50ms）

#### TagBadge

- ジャンルタグ: `bg-gray-100 text-gray-600 rounded-full px-2 py-0.5`
- ステータスタグ: `bg-blue-50 text-blue-600 rounded-full px-2 py-0.5`
- アプリタグ: 各アプリのアクセントカラー背景

#### EmptyState

- イラスト or 絵文字（64px）+ 説明文 + CTA ボタン
- データ 0 件時に全画面で表示

---

## 3. 各画面詳細設計

### S-01: スプラッシュ

| 項目 | 内容 |
|---|---|
| **目的** | アプリ起動中のブランド印象付け |
| **表示時間** | 最大 2 秒（認証チェック完了で即遷移） |
| **レイアウト** | 中央にアプリロゴ + "BookLoop" テキスト。背景 `gray-50` |
| **遷移先** | 認証済 → S-04 or S-02 / 未認証 → S-03 |

---

### S-02: オンボーディング

| 項目 | 内容 |
|---|---|
| **目的** | 初回 3 分以内にセッション完了まで導く |
| **表示条件** | 初回ログイン時のみ |
| **遷移先** | 完了 → S-04 ホーム |

#### ステップ構成

| Step | 内容 | 操作 |
|---|---|---|
| 1 | コンセプト紹介 — ロゴ + 「読書を、毎日の習慣に。」 | 「次へ」タップ |
| 2 | 目標設定 — 週の読書日数（3/4/5/7）+ 月の読了冊数（1/2/3/4） | プリセット選択 → 「次へ」 |
| 3 | 最初の 1 冊追加 — 検索バー + おすすめ書籍リスト | 書籍追加 or 「あとで追加する」 |

#### インタラクション詳細

- **ページインジケーター:** 下部に 3 ドット。現在ステップ = `gray-800`、その他 = `gray-300`
- **目標選択:** 選択中のカード = `bg-gray-800 text-white`。未選択 = `border-gray-300 bg-white`
- **スキップ:** Step 3 のみ「あとで追加する」リンク表示
- **目標デフォルト値:** 週 5 日 / 月 2 冊

#### 状態管理

| 状態 | 処理 |
|---|---|
| 途中離脱 | `users.onboarding_completed = false` として保存。次回起動時に Step 1 から再開 |
| 完了 | `users.onboarding_completed = true`、目標値を `users` テーブルに保存 |

---

### S-03: ログイン / サインアップ

| 項目 | 内容 |
|---|---|
| **目的** | 低摩擦での認証 |
| **遷移先** | 認証成功 → S-02（初回）or S-04（既存） |

#### レイアウト

```
┌──────────────────────────┐
│                          │
│       📚 BookLoop        │
│   「読書を、毎日の習慣に。」 │
│                          │
│  ┌────────────────────┐  │
│  │ Continue with Google│  │    ← OAuth ボタン群
│  └────────────────────┘  │
│  ┌────────────────────┐  │
│  │ Continue with Apple │  │
│  └────────────────────┘  │
│                          │
│  ──────── or ────────    │
│                          │
│  メールアドレス [________]│    ← メール認証
│  パスワード    [________]│
│  [  ログイン  ]          │
│                          │
│  アカウントをお持ちでない方  │
│  → サインアップ            │
│  パスワードを忘れた方       │
└──────────────────────────┘
```

#### バリデーション

| フィールド | ルール | エラーメッセージ |
|---|---|---|
| メール | 必須 / 形式チェック | 「有効なメールアドレスを入力してください」 |
| パスワード | 必須 / 8文字以上 | 「パスワードは8文字以上で入力してください」 |

#### エラーハンドリング

| ケース | 表示 |
|---|---|
| 認証失敗 | 「メールアドレスまたはパスワードが正しくありません」（トースト） |
| OAuth 失敗 | 「認証に失敗しました。もう一度お試しください」（トースト） |
| ネットワークエラー | 「接続できませんでした。通信環境を確認してください」（トースト） |

---

### S-04: ホーム

| 項目 | 内容 |
|---|---|
| **目的** | 毎日最初に目にする画面。ストリーク確認 → 即セッション開始の導線 |
| **タブ位置** | BottomNav 1番目（🏠） |
| **遷移先** | セッション開始 → S-08a / あとから記録 → S-08c / 書籍タップ → S-07 / 本棚 → S-05 |

#### セクション構成（上から順）

| # | セクション | 内容 |
|---|---|---|
| 1 | **ヘッダー** | 「おはようございます」+ ユーザー表示名 + アバター |
| 2 | **ストリークカード** | 現在ストリーク数（Display サイズ）+ 🔥 + 最長記録 + 週間ドット |
| 3 | **今日の目標** | 当日のセッション有無。進捗バー表示 |
| 4 | **読書中リスト** | `status = READING` の書籍を最大 3 冊表示。「すべて見る →」で S-05 へ |
| 5 | **CTA エリア** | 「📖 読書をはじめる」（Primary） + 「🕐 あとから記録」（Outline） |

#### ストリークカードの状態

| 状態 | 表示 |
|---|---|
| 当日未読書 | 今日のドット = `bg-white/30 border-white/50`（未完了スタイル） |
| 当日読書済 | 今日のドット = `bg-white` + ✓ マーク |
| フリーズ使用日 | ドット = `bg-blue-300` + ❄️ マーク |
| ストリーク 0 日 | 数値 "0" + 「今日から始めよう！」メッセージ |

#### 挨拶ロジック

| 時間帯 | テキスト |
|---|---|
| 5:00–11:59 | おはようございます |
| 12:00–17:59 | こんにちは |
| 18:00–4:59 | こんばんは |

#### 今日の目標セクション

| 状態 | テキスト | 進捗バー |
|---|---|---|
| 未読書 | 「今日まだ読書していません」 | 0% |
| セッション完了 | 「今日の読書完了！」+ 読書時間 | 100%（`bg-green-500`） |

---

### S-05: 本棚

| 項目 | 内容 |
|---|---|
| **目的** | 書籍の一元管理 |
| **タブ位置** | BottomNav 2番目（📚） |
| **遷移先** | 書籍タップ → S-07 / 追加ボタン → S-06 |

#### レイアウト

| # | 要素 | 仕様 |
|---|---|---|
| 1 | **検索バー** | プレースホルダー「タイトル・著者で検索...」。タップで S-06 へ |
| 2 | **ステータスタブ** | 「読みたい / 読書中 / 読了」。各タブに冊数バッジ |
| 3 | **表示切替** | グリッド / リスト。デフォルト = グリッド |
| 4 | **書籍グリッド** | 3列グリッド。書影アスペクト比 2:3 |
| 5 | **追加カード** | グリッド末尾に「＋追加」破線カード |

#### グリッド表示

- **列数:** 3
- **書影サイズ:** 幅 100%（親コンテナ準拠）× アスペクト比 2:3
- **書名:** 書影下に 11px、最大 2 行（overflow: hidden）
- **ソート:** 追加日（降順）がデフォルト。タイトル / 著者 / ステータスに切替可

#### リスト表示

```
┌──────────────────────────────────┐
│ ┌──────┐ タイトル                │
│ │ 書影  │ 著者名 · ジャンルタグ    │
│ │48×64 │ ████████░░ 67% (読書中) │
│ └──────┘                        │
└──────────────────────────────────┘
```

#### EmptyState（タブ別）

| タブ | メッセージ | CTA |
|---|---|---|
| 読みたい | 「読みたい本を追加しよう」 | 「＋ 書籍を探す」 |
| 読書中 | 「今読んでいる本を追加しよう」 | 「＋ 書籍を探す」 |
| 読了 | 「最初の 1 冊を読了しよう！」 | — |

---

### S-06: 書籍検索

| 項目 | 内容 |
|---|---|
| **目的** | ISBN / キーワードで書籍を発見し、本棚に追加 |
| **表示方法** | S-05 からモーダル or プッシュ遷移 |
| **遷移先** | 書籍追加完了 → S-05（トースト「本棚に追加しました」） |

#### 検索仕様

| 項目 | 仕様 |
|---|---|
| 入力 | タイトル / 著者名 / ISBN（13桁） |
| API | Google Books API（プライマリ）→ OpenBD（フォールバック） |
| デバウンス | 500ms |
| 結果表示 | 最大 20 件。書影 + タイトル + 著者 + 出版社 |
| バーコードスキャン | モバイルのみ。検索バー右にカメラアイコン |

#### 検索結果カード

```
┌──────────────────────────────────────┐
│ ┌──────┐ タイトル                    │
│ │ 書影  │ 著者名                     │
│ │40×56 │ 出版社 · 248ページ          │
│ └──────┘            [＋ 本棚に追加]   │
└──────────────────────────────────────┘
```

#### 手動追加（検索で見つからない場合）

- 検索結果下部に「見つからない場合 → 手動で追加」リンク
- 入力項目: タイトル（必須）/ 著者（任意）/ ページ数（任意）

---

### S-07: 書籍詳細

| 項目 | 内容 |
|---|---|
| **目的** | 1 冊の読書データを集約表示 |
| **遷移元** | S-04 ホーム / S-05 本棚 |
| **遷移先** | 続きを読む → S-08a / あとから記録 → S-08c |

#### セクション構成

| # | セクション | 内容 |
|---|---|---|
| 1 | **ヘッダー** | ← 戻る |
| 2 | **書籍情報** | 書影（96×144px）+ タイトル + 著者 + 出版社 + ページ数 + ジャンルタグ + ステータスタグ |
| 3 | **進捗バー** | `current_page / total_pages` + パーセンテージ |
| 4 | **統計カード** | 読書時間 / セッション回数 / 開始日（3列グリッド） |
| 5 | **CTA** | 「📖 続きを読む」（Primary） + 「🕐 あとから記録」（Outline） |
| 6 | **メモ一覧** | ページ番号 + メモ内容 + 日付。「＋ 追加」で新規メモ |

#### ステータスによるCTA変化

| ステータス | Primary CTA | 備考 |
|---|---|---|
| WANT_TO_READ | 「📖 読書をはじめる」 | タップで `status = READING` に更新 |
| READING | 「📖 続きを読む」 | — |
| FINISHED | 「📖 もう一度読む」 | タップで `status = READING`, `current_page = 0` |

#### メモカード

```
┌──────────────────────────────┐
│ p.45                   2/15  │
│ メモ内容テキスト...           │
└──────────────────────────────┘
```

- 最新順で表示。最大 50 件（ページネーション）
- タップで編集モーダル
- 左スワイプで削除確認

---

### S-08a: セッション開始

| 項目 | 内容 |
|---|---|
| **目的** | 読書方法を選択してセッションを開始 |
| **遷移元** | S-04 ホーム / S-07 書籍詳細 |
| **遷移先** | アプリ内 → S-08 / 外部アプリ → S-08b |

#### レイアウト

| # | 要素 | 仕様 |
|---|---|---|
| 1 | **選択中の書籍** | BookCard + 「変更」リンク |
| 2 | **読書方法選択** | 2つの大型カード |
| 3 | **外部アプリ選択** | 「外部アプリで読む」選択後に表示。4つのアプリカード |
| 4 | **CTA** | 選択内容に応じてラベル変化 |
| 5 | **補足説明** | 「タイマーはバックグラウンドで計測されます」 |

#### 読書方法カード

| 選択肢 | アイコン | 説明 |
|---|---|---|
| このアプリで読む | 📖 | BookLoop 内でタイマー計測 |
| 外部アプリで読む | 📱 | Kindle / Kobo / Apple Books 等 |

#### 外部アプリ選択

| アプリ | アイコン | アクセント色 |
|---|---|---|
| Kindle | 📙 | `amber` |
| Kobo | 📘 | `blue` |
| Apple Books | 📕 | `orange` |
| その他 | 📗 | `gray` |

- 選択中: `border-gray-800 bg-gray-50` + ドットインジケーター
- 最後に使用したアプリを記憶し、次回デフォルト選択

#### CTA ラベル変化

| 状態 | ラベル |
|---|---|
| アプリ内選択 | 「読書をはじめる」 |
| Kindle 選択 | 「タイマーを開始して Kindle で読む」 |
| Kobo 選択 | 「タイマーを開始して Kobo で読む」 |

---

### S-08: 読書セッション（アプリ内）

| 項目 | 内容 |
|---|---|
| **目的** | 集中を妨げないミニマルなタイマー画面 |
| **背景** | `gray-900`（ダークテーマ） |
| **BottomNav** | 非表示 |
| **遷移先** | 終了 → S-09 |

#### レイアウト

| # | 要素 | 仕様 |
|---|---|---|
| 1 | **ナビ** | ← 終了（左）/ ⋮ メニュー（右） |
| 2 | **書籍情報** | ミニ書影 + タイトル + 著者（白文字 / 低不透明度） |
| 3 | **タイマー** | MM:SS 表示（Display サイズ 72px Black） |
| 4 | **ステータス** | 「読書中...」/ 「一時停止中」 |
| 5 | **コントロール** | 一時停止（左）/ 終了（中央・大）/ メモ（右） |
| 6 | **クイックメモ** | 下部に入力バー |

#### タイマー仕様

| 項目 | 仕様 |
|---|---|
| 計測方式 | カウントアップ（00:00 から） |
| 表示更新 | 1 秒間隔 |
| バックグラウンド | `started_at` を保存。復帰時に差分計算で表示更新 |
| 一時停止 | 経過時間をローカル保存。再開で加算継続 |
| 自動終了 | 24 時間経過で自動終了 → 通知で確認 |

#### コントロールボタン

| ボタン | サイズ | スタイル | アクション |
|---|---|---|---|
| 一時停止 | 64px | `border-gray-600` 丸 | タイマー停止 / 再開トグル |
| 終了 | 80px | `bg-white` 丸 | → S-09 へ遷移 |
| メモ | 64px | `border-gray-600` 丸 | メモ入力バーにフォーカス |

#### 「← 終了」タップ時の確認

- 1 分未満の場合:「1 分未満のセッションは記録されません。終了しますか？」→ はい / いいえ
- 1 分以上の場合: 確認なしで S-09 へ

---

### S-08b: 外部アプリ読書中

| 項目 | 内容 |
|---|---|
| **目的** | Kindle 等で読書中のユーザーにタイマー計測を継続 |
| **背景** | `gray-900`（ダークテーマ） |
| **BottomNav** | 非表示 |
| **遷移先** | 読書を終了 → S-09 |

#### S-08 との差分

| 要素 | S-08（アプリ内） | S-08b（外部） |
|---|---|---|
| アプリバッジ | なし | アプリアイコン + 「Kindle で読書中」タグ |
| 通知プレビュー | なし | 通知バーの見た目をプレビュー表示 |
| コントロール | 3ボタン（一時停止/終了/メモ） | 2ボタン（メモ/終了） |
| 下部テキスト | クイックメモバー | 「Kindle アプリに切り替えても〜」説明文 |

#### 通知（OS レベル）

| OS | 仕様 |
|---|---|
| Android | Foreground Service による常時通知。「BookLoop — MM:SS 読書中」+ 「終了」アクション |
| iOS | 通知バナー + 定期更新（30 秒間隔）。iOS 制約により精度は限定的 |
| Web | ブラウザ通知は送らない（タブ/ウィンドウ維持） |

---

### S-08c: あとから記録

| 項目 | 内容 |
|---|---|
| **目的** | 過去の読書を手動で記録 |
| **遷移元** | S-04 ホーム / S-07 書籍詳細 |
| **遷移先** | 保存 → S-04 ホーム（トースト「記録を保存しました」） |

#### 入力フォーム

| # | フィールド | 必須 | 仕様 |
|---|---|---|---|
| 1 | 読んだ本 | 必須 | BookCard 表示 + 「変更」リンク。遷移元で書籍が決まっている場合はプリセット |
| 2 | 読書した日 | 必須 | 日付ピッカー + クイック選択（「今日」「昨日」「一昨日」） |
| 3 | 読んだ方法 | 必須 | 4択（紙の本 / Kindle / Kobo / その他） |
| 4 | 読書時間 | 必須 | 時間 + 分のピッカー + クイック選択（15分/30分/45分/1時間） |
| 5 | 読んだページ | 任意 | 開始ページ + 終了ページ。開始のデフォルト = `current_page` |
| 6 | メモ | 任意 | 自由テキスト。プレースホルダー「気づいたことを書き留めよう...」 |

#### バリデーション

| ルール | エラー表示 |
|---|---|
| 日付が 7 日以内 | 「記録できるのは過去 7 日以内です」 |
| 時間が 0 分 | 「読書時間を入力してください」 |
| 同日同時間帯に重複 | 「同じ時間帯にすでに記録があります」 |
| 終了ページ < 開始ページ | 「終了ページは開始ページ以上にしてください」 |

---

### S-09: セッション完了

| 項目 | 内容 |
|---|---|
| **目的** | 達成感の演出 + ページ範囲・メモの記録 |
| **遷移元** | S-08 / S-08b |
| **遷移先** | 保存 → S-04 ホーム |

#### セクション構成

| # | セクション | 内容 |
|---|---|---|
| 1 | **祝福ヘッダー** | 🎉 + 「おつかれさまでした！」+ 「今日も読書を続けられました」 |
| 2 | **セッションサマリー** | 読書時間 / ストリーク数 / 記録方法（3列） |
| 3 | **ページ入力** | 開始ページ（デフォルト = `current_page`）→ 終了ページ + 読了ページ数自動計算 |
| 4 | **メモ** | 自由テキスト（任意） |
| 5 | **CTA** | 「保存する」（Primary）+ 「メモを書いてから保存」（Outline） |

#### 祝福演出

| 条件 | 追加演出 |
|---|---|
| ストリーク更新（当日初セッション） | 🔥 ストリーク +1 アニメーション |
| 最長ストリーク更新 | 🏆「新記録！」バッジ表示 |
| 書籍読了（`page_end >= total_pages`） | 📚「読了おめでとう！」+ 紙吹雪アニメーション |

#### 保存処理

1. `reading_sessions` に新規レコード作成
2. `user_books.current_page` を `page_end` で更新
3. `page_end >= total_pages` の場合 → `user_books.status = FINISHED`
4. 当日初セッションの場合 → `streaks.current_streak` を +1
5. `current_streak > longest_streak` の場合 → `longest_streak` も更新

---

### S-10: 統計ダッシュボード

| 項目 | 内容 |
|---|---|
| **目的** | 成長の実感と自己効力感 |
| **タブ位置** | BottomNav 3番目（📊） |

#### 期間タブ

| タブ | 集計範囲 |
|---|---|
| 今週 | 月曜〜日曜（ユーザー TZ 基準） |
| 今月 | 1日〜末日 |
| 累計 | 全期間 |

#### セクション構成

| # | セクション | 内容 |
|---|---|---|
| 1 | **KPI カード** | 読書時間 / 読了冊数 / ストリーク / ページ数（2×2 グリッド） |
| 2 | **読書方法の内訳** | アプリ内 / Kindle / Kobo / その他のスタックドバー + 凡例 |
| 3 | **日別バーチャート** | 選択期間の日別読書時間（分）。読書した日 = `gray-800`、未読 = `gray-100` |
| 4 | **月間ヒートマップ** | カレンダー形式。読書量に応じて濃淡（4段階） |
| 5 | **平均セッション時間** | 選択期間の平均 |

#### ヒートマップ色段階

| 段階 | 読書時間 | 色 |
|---|---|---|
| 0 | 0 分 | `gray-100` |
| 1 | 1–15 分 | `gray-300` |
| 2 | 16–30 分 | `gray-500` |
| 3 | 31 分以上 | `gray-800` |

#### 読書方法の内訳バー

| ソース | 色 | ラベル |
|---|---|---|
| IN_APP | `gray-800` | アプリ内 |
| KINDLE | `amber-500` | Kindle |
| KOBO | `blue-500` | Kobo |
| APPLE_BOOKS | `orange-500` | Apple Books |
| OTHER | `gray-400` | その他 |

---

### S-11: プロフィール / 設定

| 項目 | 内容 |
|---|---|
| **目的** | ユーザー情報・アプリ設定の管理 |
| **タブ位置** | BottomNav 4番目（👤） |

#### セクション構成

| # | セクション | 項目 |
|---|---|---|
| 1 | **プロフィール** | アバター画像（変更可）/ 表示名（変更可） |
| 2 | **読書目標** | 週の読書日数 / 月の読了冊数（変更可） |
| 3 | **通知設定** | リマインド ON/OFF / リマインド時刻（デフォルト 21:00） |
| 4 | **タイムゾーン** | 自動検出 + 手動変更可 |
| 5 | **アカウント** | パスワード変更 / ログアウト / アカウント削除 |
| 6 | **アプリ情報** | バージョン / 利用規約 / プライバシーポリシー |

---

## 4. エラー・エッジケース一覧

### 4.1 グローバルエラー

| ケース | 表示 | アクション |
|---|---|---|
| ネットワークオフライン | 画面上部に黄色バナー「オフラインです」 | セッション記録はローカル保存。復帰時に自動同期 |
| API 5xx エラー | トースト「サーバーに接続できません」 | 自動リトライ（3回まで） |
| 認証トークン期限切れ | リフレッシュトークンで自動更新。失敗時 → S-03 へ | — |

### 4.2 画面固有のエッジケース

| 画面 | ケース | 処理 |
|---|---|---|
| S-04 | 読書中の本が 0 冊 | 「最初の 1 冊を追加しよう」EmptyState + CTA |
| S-05 | 本棚が空 | タブ別 EmptyState 表示 |
| S-06 | 書籍検索結果 0 件 | 「見つかりませんでした。手動で追加できます」+ 手動追加リンク |
| S-06 | Google Books API レート制限 | OpenBD にフォールバック。両方失敗時 → 手動追加を促す |
| S-08 | バックグラウンドで OS にキルされた | 次回起動時に `started_at` から経過時間を復元 → セッション継続 or 終了確認 |
| S-08 | 24 時間超過 | 自動終了 + プッシュ通知「セッションが自動終了されました」 |
| S-08b | 外部アプリ読書中にアプリ削除 | セッション孤立。次回起動時に終了確認ダイアログ |
| S-08c | 過去 7 日以前の日付を選択 | 日付ピッカーで選択不可にグレーアウト |
| S-09 | 終了ページ > total_pages | 「ページ数を超えています」バリデーション |
| S-10 | データ 0 件（新規ユーザー） | 各グラフ位置に「読書を始めるとここに統計が表示されます」 |

---

## 5. アニメーション・トランジション仕様

| 対象 | アニメーション | 時間 |
|---|---|---|
| 画面遷移（プッシュ） | 右からスライドイン | 300ms ease-out |
| 画面遷移（モーダル） | 下からスライドアップ | 300ms ease-out |
| ボタンタップ | opacity 0.8 + scale 0.98 | 50ms |
| ストリーク +1 | 数字のカウントアップ + 🔥 パルス | 600ms |
| 読了達成 | 紙吹雪パーティクル | 2000ms |
| トースト | 上からフェードイン → 3 秒後にフェードアウト | 300ms in / 300ms out |
| タブ切替 | クロスフェード | 200ms |
| プログレスバー更新 | 幅アニメーション | 400ms ease-in-out |

---

## 6. アクセシビリティ要件（MVP 最低限）

| 項目 | 対応 |
|---|---|
| テキストコントラスト | WCAG AA 準拠（4.5:1 以上） |
| タッチターゲット | 最小 44×44px |
| スクリーンリーダー | 主要ボタン・入力に `accessibilityLabel` 設定 |
| フォントサイズ | OS の Dynamic Type / フォントスケーリングに追従 |
| ダークモード | Phase 2 で対応（MVP はライトモードのみ。セッション画面除く） |
